<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ร้านเรียกคิว</title>

<style>
body{
  font-family:system-ui;
  background:linear-gradient(135deg,#4f46e5,#7c3aed);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  margin:0;
}
.card{
  background:#fff;
  padding:24px;
  width:320px;
  border-radius:16px;
  text-align:center;
  box-shadow:0 20px 40px rgba(0,0,0,.2);
}
button,input{
  width:100%;
  padding:12px;
  margin-top:10px;
  font-size:1rem;
  border-radius:10px;
}
button{
  border:none;
  background:#4f46e5;
  color:#fff;
}
.reset{
  background:#dc2626;
}
</style>
</head>

<body>
<div class="card">
  <h2>ระบบเรียกคิว</h2>

  <button id="create">สร้าง QR คิวใหม่</button>
  <div id="qr"></div>

  <input id="queueInput" type="number" placeholder="เลขคิวที่จะเรียก">
  <button id="call">เรียกคิว</button>

  <button id="reset" class="reset">รีเซ็ตคิวทั้งหมด</button>
</div>

<script type="module">
import { createQueue, callQueueByNumber, resetAllQueues } from "./firebase.js";

const qr = document.getElementById("qr");

document.getElementById("create").onclick = async () => {
  const num = await createQueue();
  const url = `${location.origin}/wait.html?token=${num}`;
  qr.innerHTML = `
    <h3>คิว ${num}</h3>
    <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${url}">
  `;
};

document.getElementById("call").onclick = async () => {
  const num = Number(queueInput.value);
  if (!num) return alert("ใส่เลขคิวก่อน");

  const ok = await callQueueByNumber(num);
  if (!ok) alert("คิวนี้ไม่มี หรือถูกเรียกไปแล้ว");
};

document.getElementById("reset").onclick = async () => {
  if (!confirm("ลบคิวทั้งหมดจริงไหม?")) return;
  await resetAllQueues();
  qr.innerHTML = "";
  alert("รีเซ็ตคิวเรียบร้อย");
};
</script>
</body>
</html>
